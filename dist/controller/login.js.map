{"version":3,"sources":["../../src/controller/login.js"],"names":["config","db","api","post","req","res","findOne","email","body","err","user","undefined","status","json","message","password","emailverified","loginDetails","newLogin","userType","save","loginDetailsAfterSaving","send","a","toJSON","token","sign","delete","params","login","remove"],"mappings":"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","file":"login.js","sourcesContent":["import mongoose from 'mongoose';\r\nimport { Router } from 'express';\r\nimport Login from '../model/login';\r\nimport User from '../model/user';\r\nimport bodyParser from 'body-parser';\r\nimport jsonwebtoken from 'jsonwebtoken';\r\nexport default({ config, db }) => {\r\n  let api = Router();\r\n\r\n  // '/v1/login/add'\r\n  api.post('/add', (req, res) => {\r\n   //check password or match password\r\nUser.findOne({email:req.body.email},(err,user)=>{\r\n\r\n    if(!err){\r\n\r\n        if(user==undefined){ //user not found\r\n\r\n            res.status(400).json({ message: 'User not found!' });\r\n        }else{\r\n\r\n            if(user.password===req.body.password){  //password matching\r\n               if(user.emailverified==1){\r\n        //checking if user is already logged in\r\n        Login.findOne({email:req.body.email},(err,loginDetails)=>{\r\n\r\n            if(!err){\r\n                if(loginDetails===null){ //user is not already logged in\r\n                        //saving login new details\r\n                    let newLogin=new Login();\r\n                    newLogin.email=req.body.email;\r\n                    newLogin.userType=user.userType;\r\n                    newLogin.save((err,loginDetailsAfterSaving)=>{\r\n\r\n                        if(err){\r\n\r\n                            res.status(500).send(err);\r\n                        }\r\n                          let a=user.toJSON();\r\n                     a.token=loginDetailsAfterSaving.token;\r\n                    \r\n                        let token=jsonwebtoken.sign(a,\"example1\");   \r\n                        res.status(200).json({token:token});\r\n                    });\r\n\r\n                }else{  //user is already logged in\r\n                    let a=user.toJSON();\r\n                     a.token=loginDetails.token;\r\n                    \r\n                       let token=jsonwebtoken.sign(a,\"example1\");\r\n                    res.status(200).json({token:token});\r\n\r\n                }\r\n\r\n            }else{\r\n\r\n                res.status(500).send(err);\r\n            }\r\n        \r\n\r\n        });\r\n    }else{\r\n        res.status(400).json({ message: 'user not verified!' });\r\n\r\n    }\r\n            }else{\r\n                res.status(400).json({ message: 'invalid password!' });\r\n\r\n            }\r\n\r\n        }\r\n    }\r\n});\r\n  });\r\n  //logging out a user\r\n    api.delete('/logout/:email/:token',(req,res)=>{\r\n      Login.findOne({email: req.params.email}, function(err, login) {\r\n        if(!err) {\r\n          if(login===null){\r\n            res.status(400).json({ message: 'User not found!' });\r\n\r\n          }else{\r\n              if(login.token===req.params.token){\r\n            login.remove(function(err) {\r\n                if(err){\r\n\r\n                  res.send(err);\r\n                }\r\n                res.status(200).json({ message: 'User logged out successfully' });\r\n                \r\n            });\r\n        }else{\r\n            res.status(400).json({ message: 'Wrong token' });\r\n\r\n        }\r\n          }\r\n        }else{\r\n\r\n          res.status(500).send(err);\r\n        }\r\n    });\r\n\r\n    })\r\n  return api;\r\n}\r\n"]}