{"version":3,"sources":["../../src/controller/requests.js"],"names":["config","db","api","post","req","res","findOne","email","body","err","user","undefined","status","json","message","login","token","newRequest","requestName","fromDate","toDate","image1","image2","image3","image4","description","referenceLink","college","city","userId","_id","userName","lastEdit","Date","save","request","newNotification","type","refId","link","transporter","createTransport","service","auth","pass","templateString","readFileSync","mailOptions","from","to","subject","html","render","heading","name","fname","productName","console","log","sendMail","info","send","put","params","id","equals","userType","numberOfDays","delete","remove","requestApproved","findById","ownerUser","linkApproved","imageApproved","reason","get","sort","sortby","indexOf","pageNumber","isNaN","page","qry","JSON","parse","decodeURIComponent","query","countQuery","callback","find","doc","length","retrieveQuery","skip","limit","exec","parallel","results","total_pages","Math","floor","requests","RegExp","search","products","category","subCategory","subcategory","product","onHold"],"mappings":"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","file":"requests.js","sourcesContent":["import mongoose from 'mongoose';\r\nimport { Router } from 'express';\r\nimport Login from '../model/login';\r\nimport Requests from '../model/requests';\r\nimport User from '../model/user';\r\nimport bodyParser from 'body-parser';\r\nimport nodemailer from 'nodemailer';\r\nimport fs from 'fs';\r\nimport ejs from 'ejs';\r\nimport async from 'async';\r\nimport Notification from '../model/notification';\r\nexport default({ config, db }) => {\r\n  let api = Router();\r\n\r\n  // '/v1/requests/add/emailID'\r\n  api.post('/add', (req, res) => {\r\n   //check token\r\n     User.findOne({email:req.body.email},(err,user)=>{\r\n       if(user==undefined){\r\n        res.status(400).json({ message: 'User not found!' });\r\n    }else{\r\nLogin.findOne({email:req.body.email},(err,login)=>{\r\n\r\n    if(!err){\r\n\r\n        if(login==undefined){ //user not found\r\n\r\n            res.status(400).json({ message: 'User not Logged In!' });\r\n        }else{\r\n\r\n            if(login.token==req.body.token){  //password matching\r\n               \r\n                    let newRequest=new Requests();\r\n                    newRequest.requestName=req.body.requestName;\r\n                   // newRequest.image=req.body.name; saved for later\r\n                    newRequest.fromDate=req.body.fromDate;\r\n                    newRequest.toDate=req.body.toDate;\r\n                    newRequest.image1=req.body.image1;\r\n                    newRequest.image2=req.body.image2;\r\n                    newRequest.image3=req.body.image3;\r\n                    newRequest.image4=req.body.image4;\r\n                    newRequest.description=req.body.description;\r\n                    newRequest.referenceLink=req.body.referenceLink;\r\n                    newRequest.college=user.college;\r\n                    newRequest.city=user.city;\r\n                    newRequest.userId=user._id;\r\n                    newRequest.userName=req.body.userName;\r\n                    newRequest.lastEdit=Date();\r\n                    newRequest.save((err,request)=>{\r\n\r\n                        if(!err){\r\n                            let newNotification=new Notification();\r\n                            newNotification.userId=user._id;\r\n                            newNotification.message=\"Status Pending!\"\r\n                            newNotification.description=\"You Request \"+request.requestName+\" is peding on approval by moderators will get back to you soon!\";\r\n                            newNotification.type=4;\r\n                            newNotification.refId=request._id;\r\n                            newNotification.link=\"/requests\";\r\n                             //sending mail \r\n                             var transporter = nodemailer.createTransport({\r\n                                service: 'Gmail',\r\n                                auth: {\r\n                                user: 'toshikverma1@gmail.com', // Your email id\r\n                                pass: '123123123a' // Your password\r\n                                }\r\n                            });\r\n                            var templateString = fs.readFileSync('views/approvals.ejs', 'utf-8');\r\n                            var mailOptions = {\r\n                                from: 'toshikverma@gmail.com', // sender address\r\n                                to: user.email, // list of receivers\r\n                                subject: 'Request Saved', // Subject line\r\n                                html: ejs.render(templateString,{heading:\"Pending approval\",name:user.fname,message:\"Your Request is upload and pending approval!\",productName:req.body.requestName},(err)=>{\r\n                                if(err){\r\n                                    console.log(err);\r\n                                }\r\n                                }) \r\n                                \r\n                            };\r\n                            transporter.sendMail(mailOptions, function (err, info) {\r\n                                if(err)\r\n                                console.log(err)\r\n                                \r\n                                else\r\n                                console.log(info);\r\n                            });\r\n                            //sending mail ends\r\n                            newNotification.save();\r\n                                res.status(200).json(request);\r\n\r\n                        }else{\r\n\r\n                                res.status(400).json({message:\"request not saved!\"});\r\n                        }\r\n                    });\r\n                   \r\n\r\n\r\n            }else{\r\n                res.status(400).json({ message: 'invalid token!' });\r\n\r\n            }\r\n      \r\n        }\r\n       \r\n    }else{\r\n\r\n            res.status(400).send(err);\r\n        }\r\n  \r\n});\r\n    }\r\n            });\r\n  });\r\n\r\n  //updating a request\r\n\r\n  api.put('/update/:id', (req, res) => {\r\n    //check password or match password\r\n      User.findOne({email:req.body.email},(err,user)=>{\r\n        if(user==undefined){\r\n         res.status(400).json({ message: 'User not found!' });\r\n     }else{\r\n Login.findOne({email:req.body.email},(err,login)=>{\r\n \r\n     if(!err){\r\n \r\n         if(login==undefined){ //user not found\r\n \r\n             res.status(400).json({ message: 'User not Logged In!' });\r\n         }else{\r\n \r\n             if(login.token==req.body.token){  //password matching\r\n                Requests.findOne({_id:req.params.id},(err,request)=>{\r\n\r\n                   \r\n                        if(!err){\r\n                                if(request===undefined){\r\n\r\n                                    res.status(400).send({message:\"no such request exsist\"});\r\n                                }else{\r\n                               console.log(user._id);\r\n                               console.log(request.userId);\r\n                                    if(user._id.equals(request.userId) || login.userType>0){\r\n                                    request.requestName=req.body.requestName;\r\n                                    request.numberOfDays=req.body.numberOfDays;\r\n                                    request.description=req.body.description;\r\n                                    request.referenceLink=req.body.referenceLink;\r\n                                    request.image1=req.body.image1;\r\n                                    request.image2=req.body.image2;\r\n                                    request.image3=req.body.image3;\r\n                                    request.image4=req.body.image4;\r\n                                    request.fromDate=req.body.fromDate;\r\n                                    request.toDate=req.body.toDate;\r\n                                    request.lastEdit=Date();\r\n                                    request.save((err,request)=>{\r\n\r\n                                        if(!err){\r\n\r\n                                            res.status(200).send(request);\r\n                                        }else{\r\n\r\n                                            res.status(400).send({message:\"request was not saved\"});\r\n                                        }\r\n                                    \r\n                                    });\r\n\r\n                                }else{\r\n                                    \r\n                                      res.status(400).send({message:\"not authorized to update request\"});\r\n                                     }\r\n                                    }\r\n\r\n\r\n                        }else{\r\n\r\n                            res.status(400).send(err);\r\n                        }\r\n\r\n                    \r\n                });\r\n                    \r\n                    \r\n \r\n \r\n             }else{\r\n                 res.status(400).json({ message: 'invalid token!' });\r\n \r\n             }\r\n       \r\n         }\r\n        \r\n     }else{\r\n \r\n             res.status(400).send(err);\r\n         }\r\n   \r\n });\r\n     }\r\n             });\r\n   });\r\n //deleting a request\r\n api.delete('/delete/:id/:token/:email', (req, res) => {\r\n    //check password or match password\r\n      User.findOne({email:req.params.email},(err,user)=>{\r\n        if(user==undefined){\r\n         res.status(400).json({ message: 'User not found!' });\r\n     }else{\r\n Login.findOne({email:req.params.email},(err,login)=>{\r\n \r\n     if(!err){\r\n \r\n         if(login==undefined){ //user not found\r\n \r\n             res.status(400).json({ message: 'User not Logged In!' });\r\n         }else{\r\n \r\n             if(login.token==req.params.token){  //password matching\r\n                Requests.findOne({_id:req.params.id},(err,request)=>{\r\n\r\n                   \r\n                        if(!err){\r\n                                if(request===undefined){\r\n\r\n                                    res.status(400).send({message:\"no such request exsist\"});\r\n                                }else{\r\n                               console.log(user._id);\r\n                               console.log(request.userId);\r\n                                    if(user._id.equals(request.userId) || login.userType>0){\r\n                                \r\n                                    request.remove((err)=>{\r\n\r\n                                        if(!err){\r\n\r\n                                            res.status(200).send({message:\"request deleted successsfully!\"});\r\n                                        }else{\r\n\r\n                                            res.status(400).send({message:\"request was not saved\"});\r\n                                        }\r\n                                    \r\n                                    });\r\n\r\n                                }else{\r\n                                    \r\n                                      res.status(400).send({message:\"not authorized to delete request\"});\r\n                                     }\r\n                                    }\r\n\r\n\r\n                        }else{\r\n\r\n                            res.status(400).send(err);\r\n                        }\r\n\r\n                    \r\n                });\r\n                    \r\n                    \r\n \r\n \r\n             }else{\r\n                 res.status(400).json({ message: 'invalid token!' });\r\n \r\n             }\r\n       \r\n         }\r\n        \r\n     }else{\r\n \r\n             res.status(400).send(err);\r\n         }\r\n   \r\n });\r\n     }\r\n             });\r\n   });\r\n   //------------------------------------------------------------------------\r\n   //aaproval starts here!\r\n   //approving request\r\n   api.put('/approveproduct/:id', (req, res) => {\r\n    //check token\r\n      User.findOne({email:req.body.email},(err,user)=>{\r\n        if(user==undefined){\r\n         res.status(400).json({ message: 'User not found!' });\r\n     }else{\r\n Login.findOne({email:req.body.email},(err,login)=>{\r\n \r\n     if(!err){\r\n \r\n         if(login==undefined){ //user not found\r\n \r\n             res.status(400).json({ message: 'User not Logged In!' });\r\n         }else{\r\n \r\n            if(login.token==req.body.token && user.userType>0){  //token matching\r\n                Requests.findOne({_id:req.params.id},(err,request)=>{\r\n\r\n                   \r\n                        if(!err){\r\n                                if(request===undefined){\r\n\r\n                                    res.status(400).send({message:\"no such request exsist\"});\r\n                                }else{\r\n                            \r\n                                  \r\n                                request.requestApproved=1;\r\n                                    request.save((err)=>{\r\n\r\n                                        if(!err){\r\n                                            let newNotification=new Notification();\r\n                                            newNotification.userId=request.userId;\r\n                                            newNotification.message=\"Request Approved!\"\r\n                                            newNotification.description=\"Your Request \"+request.requestName+\" has been approved\";\r\n                                            newNotification.type=4;\r\n                                            newNotification.refId=request._id;\r\n                                            newNotification.link=\"/requests\";\r\n                                            newNotification.save();\r\n                                            User.findById((request.userId),(err,ownerUser)=>{\r\n                                                \r\n                                                                                                if(!err){\r\n                                            //sending mail \r\n  var transporter = nodemailer.createTransport({\r\n    service: 'Gmail',\r\n    auth: {\r\n    user: 'toshikverma1@gmail.com', // Your email id\r\n    pass: '123123123a' // Your password\r\n    }\r\n});\r\nvar templateString = fs.readFileSync('views/approvals.ejs', 'utf-8');\r\nvar mailOptions = {\r\n    from: 'toshikverma@gmail.com', // sender address\r\n    to: ownerUser.email, // list of receivers\r\n    subject: 'Approvals', // Subject line\r\n    html: ejs.render(templateString,{heading:\"Accepted\",name:ownerUser.fname,message:\"Your Request is Approved!\",productName:request.requestName},(err)=>{\r\n    if(err){\r\n        console.log(err);\r\n    }\r\n    }) \r\n    \r\n};\r\ntransporter.sendMail(mailOptions, function (err, info) {\r\n    if(err)\r\n    console.log(err)\r\n    \r\n    else\r\n    console.log(info);\r\n});\r\n//sending mail ends\r\n                                                                                                }});                             \r\nres.status(200).send({message:\"request approved!\"});\r\n                                        }else{\r\n\r\n                                            res.status(400).send({message:\"some problem occured\"});\r\n                                        }\r\n                                    \r\n                                    });\r\n\r\n                              \r\n                                    }\r\n\r\n\r\n                        }else{\r\n\r\n                            res.status(400).send(err);\r\n                        }\r\n\r\n                    \r\n                });\r\n                    \r\n                    \r\n \r\n \r\n             }else{\r\n                 res.status(400).json({ message: 'invalid token!' });\r\n \r\n             }\r\n       \r\n         }\r\n        \r\n     }else{\r\n \r\n             res.status(400).send(err);\r\n         }\r\n   \r\n });\r\n     }\r\n             });\r\n   });\r\n    //approving link\r\n    api.put('/approvelink/:id', (req, res) => {\r\n        //check token\r\n          User.findOne({email:req.body.email},(err,user)=>{\r\n            if(user==undefined){\r\n             res.status(400).json({ message: 'User not found!' });\r\n         }else{\r\n     Login.findOne({email:req.body.email},(err,login)=>{\r\n     \r\n         if(!err){\r\n     \r\n             if(login==undefined){ //user not found\r\n     \r\n                 res.status(400).json({ message: 'User not Logged In!' });\r\n             }else{\r\n     \r\n                if(login.token==req.body.token && user.userType>0){  //token matching\r\n                    Requests.findOne({_id:req.params.id},(err,request)=>{\r\n    \r\n                       \r\n                            if(!err){\r\n                                    if(request===undefined){\r\n    \r\n                                        res.status(400).send({message:\"no such request exsist\"});\r\n                                    }else{\r\n                                \r\n                                      \r\n                                    request.linkApproved=1;\r\n                                        request.save((err)=>{\r\n    \r\n                                            if(!err){\r\n    \r\n                                                res.status(200).send({message:\"link  approved!\"});\r\n                                            }else{\r\n    \r\n                                                res.status(400).send({message:\"some problem occured\"});\r\n                                            }\r\n                                        \r\n                                        });\r\n    \r\n                                  \r\n                                        }\r\n    \r\n    \r\n                            }else{\r\n    \r\n                                res.status(400).send(err);\r\n                            }\r\n    \r\n                        \r\n                    });\r\n                        \r\n                        \r\n     \r\n     \r\n                 }else{\r\n                     res.status(400).json({ message: 'invalid token!' });\r\n     \r\n                 }\r\n           \r\n             }\r\n            \r\n         }else{\r\n     \r\n                 res.status(400).send(err);\r\n             }\r\n       \r\n     });\r\n         }\r\n                 });\r\n       });\r\n       //approving  iamges\r\n    api.put('/approveimages/:id', (req, res) => {\r\n        //check token\r\n          User.findOne({email:req.body.email},(err,user)=>{\r\n            if(user==undefined){\r\n             res.status(400).json({ message: 'User not found!' });\r\n         }else{\r\n     Login.findOne({email:req.body.email},(err,login)=>{\r\n     \r\n         if(!err){\r\n     \r\n             if(login==undefined){ //user not found\r\n     \r\n                 res.status(400).json({ message: 'User not Logged In!' });\r\n             }else{\r\n     \r\n                if(login.token==req.body.token && user.userType>0){  //token matching\r\n                    Requests.findOne({_id:req.params.id},(err,request)=>{\r\n    \r\n                       \r\n                            if(!err){\r\n                                    if(request===undefined){\r\n    \r\n                                        res.status(400).send({message:\"no such request exsist\"});\r\n                                    }else{\r\n                                \r\n                                      \r\n                                    request.imageApproved=1;\r\n                                        request.save((err)=>{\r\n    \r\n                                            if(!err){\r\n    \r\n                                                res.status(200).send({message:\"image approved!\"});\r\n                                            }else{\r\n    \r\n                                                res.status(400).send({message:\"some problem occured\"});\r\n                                            }\r\n                                        \r\n                                        });\r\n    \r\n                                  \r\n                                        }\r\n    \r\n    \r\n                            }else{\r\n    \r\n                                res.status(400).send(err);\r\n                            }\r\n    \r\n                        \r\n                    });\r\n                        \r\n                        \r\n     \r\n     \r\n                 }else{\r\n                     res.status(400).json({ message: 'invalid token!' });\r\n     \r\n                 }\r\n           \r\n             }\r\n            \r\n         }else{\r\n     \r\n                 res.status(400).send(err);\r\n             }\r\n       \r\n     });\r\n         }\r\n                 });\r\n       });\r\n        //rejecting request\r\n   api.put('/rejectproduct/:id', (req, res) => {\r\n    //check token\r\n      User.findOne({email:req.body.email},(err,user)=>{\r\n        if(user==undefined){\r\n         res.status(400).json({ message: 'User not found!' });\r\n     }else{\r\n Login.findOne({email:req.body.email},(err,login)=>{\r\n \r\n     if(!err){\r\n \r\n         if(login==undefined){ //user not found\r\n \r\n             res.status(400).json({ message: 'User not Logged In!' });\r\n         }else{\r\n \r\n            if(login.token==req.body.token && user.userType>0){  //token matching\r\n                Requests.findOne({_id:req.params.id},(err,request)=>{\r\n\r\n                   \r\n                        if(!err){\r\n                                if(request===undefined){\r\n\r\n                                    res.status(400).send({message:\"no such request exsist\"});\r\n                                }else{\r\n                            \r\n                                  \r\n                                request.requestApproved=2;\r\n                                    request.save((err)=>{\r\n\r\n                                        if(!err){\r\n                                                let newNotification=new Notification();\r\n                                                newNotification.userId=request.userId;\r\n                                                newNotification.message=\"request Rejected!\"\r\n                                                newNotification.description=req.body.description;\r\n                                                newNotification.type=1;\r\n                                                newNotification.refId=request._id;\r\n                                                newNotification.link=\"/requests\";\r\n                                                User.findById((request.userId),(err,ownerUser)=>{\r\n                                                    \r\n                                                                                                    if(!err){\r\n                                                //sending mail \r\n      var transporter = nodemailer.createTransport({\r\n        service: 'Gmail',\r\n        auth: {\r\n        user: 'toshikverma1@gmail.com', // Your email id\r\n        pass: '123123123a' // Your password\r\n        }\r\n    });\r\n    var templateString = fs.readFileSync('views/rejected.ejs', 'utf-8');\r\n    var mailOptions = {\r\n        from: 'toshikverma@gmail.com', // sender address\r\n        to: ownerUser.email, // list of receivers\r\n        subject: 'Approvals', // Subject line\r\n        html: ejs.render(templateString,{heading:\"Rejected\",name:ownerUser.fname,message:\"Your Request is Rejected!\",productName:request.requestName,reason:req.body.description},(err)=>{\r\n        if(err){\r\n            console.log(err);\r\n        }\r\n        }) \r\n        \r\n    };\r\n    transporter.sendMail(mailOptions, function (err, info) {\r\n        if(err)\r\n        console.log(err)\r\n        \r\n        else\r\n        console.log(info);\r\n    });\r\n    //sending mail ends\r\n                                                                                                    }});          \r\n                                                newNotification.save();\r\n                                            res.status(200).send({message:\"Request rejected!\"});\r\n                                        }else{\r\n\r\n                                            res.status(400).send({message:\"some problem occured\"});\r\n                                        }\r\n                                    \r\n                                    });\r\n\r\n                              \r\n                                    }\r\n\r\n\r\n                        }else{\r\n\r\n                            res.status(400).send(err);\r\n                        }\r\n\r\n                    \r\n                });\r\n                    \r\n                    \r\n \r\n \r\n             }else{\r\n                 res.status(400).json({ message: 'invalid token!' });\r\n \r\n             }\r\n       \r\n         }\r\n        \r\n     }else{\r\n \r\n             res.status(400).send(err);\r\n         }\r\n   \r\n });\r\n     }\r\n             });\r\n   });\r\n    //approving link\r\n    api.put('/rejectlink/:id', (req, res) => {\r\n        //check token\r\n          User.findOne({email:req.body.email},(err,user)=>{\r\n            if(user==undefined){\r\n             res.status(400).json({ message: 'User not found!' });\r\n         }else{\r\n     Login.findOne({email:req.body.email},(err,login)=>{\r\n     \r\n         if(!err){\r\n     \r\n             if(login==undefined){ //user not found\r\n     \r\n                 res.status(400).json({ message: 'User not Logged In!' });\r\n             }else{\r\n     \r\n                if(login.token==req.body.token && user.userType>0){  //token matching\r\n                    Requests.findOne({_id:req.params.id},(err,request)=>{\r\n    \r\n                       \r\n                            if(!err){\r\n                                    if(request===undefined){\r\n    \r\n                                        res.status(400).send({message:\"no such request exsist\"});\r\n                                    }else{\r\n                                \r\n                                      \r\n                                    request.linkApproved=0;\r\n                                        request.save((err)=>{\r\n    \r\n                                            if(!err){\r\n                                                let newNotification=new Notification();\r\n                                                newNotification.userId=request.userId;\r\n                                                newNotification.message=\"Link Rejected!\"\r\n                                                newNotification.description=req.body.description;\r\n                                                newNotification.type=1;\r\n                                                newNotification.refId=request._id;\r\n                                                newNotification.link=\"/requests\";\r\n                                                User.findById((request.userId),(err,ownerUser)=>{\r\n                                                    \r\n                                                                                                    if(!err){\r\n                                                //sending mail \r\n      var transporter = nodemailer.createTransport({\r\n        service: 'Gmail',\r\n        auth: {\r\n        user: 'toshikverma1@gmail.com', // Your email id\r\n        pass: '123123123a' // Your password\r\n        }\r\n    });\r\n    var templateString = fs.readFileSync('views/rejected.ejs', 'utf-8');\r\n    var mailOptions = {\r\n        from: 'toshikverma@gmail.com', // sender address\r\n        to: ownerUser.email, // list of receivers\r\n        subject: 'Approvals', // Subject line\r\n        html: ejs.render(templateString,{heading:\"Rejected\",name:ownerUser.fname,message:\"Your Link is rejected!\",productName:request.requestName,reason:req.body.description},(err)=>{\r\n        if(err){\r\n            console.log(err);\r\n        }\r\n        }) \r\n        \r\n    };\r\n    transporter.sendMail(mailOptions, function (err, info) {\r\n        if(err)\r\n        console.log(err)\r\n        \r\n        else\r\n        console.log(info);\r\n    });\r\n    //sending mail ends\r\n                                                                                                    }});        \r\n                                                newNotification.save();\r\n                                                res.status(200).send({message:\"Link  rejected!\"});\r\n                                            }else{\r\n    \r\n                                                res.status(400).send({message:\"some problem occured\"});\r\n                                            }\r\n                                        \r\n                                        });\r\n    \r\n                                  \r\n                                        }\r\n    \r\n    \r\n                            }else{\r\n    \r\n                                res.status(400).send(err);\r\n                            }\r\n    \r\n                        \r\n                    });\r\n                        \r\n                        \r\n     \r\n     \r\n                 }else{\r\n                     res.status(400).json({ message: 'invalid token!' });\r\n     \r\n                 }\r\n           \r\n             }\r\n            \r\n         }else{\r\n     \r\n                 res.status(400).send(err);\r\n             }\r\n       \r\n     });\r\n         }\r\n                 });\r\n       });\r\n       //approving  iamges\r\n    api.put('/rejectimages/:id', (req, res) => {\r\n        //check token\r\n          User.findOne({email:req.body.email},(err,user)=>{\r\n            if(user==undefined){\r\n             res.status(400).json({ message: 'User not found!' });\r\n         }else{\r\n     Login.findOne({email:req.body.email},(err,login)=>{\r\n     \r\n         if(!err){\r\n     \r\n             if(login==undefined){ //user not found\r\n     \r\n                 res.status(400).json({ message: 'User not Logged In!' });\r\n             }else{\r\n     \r\n                if(login.token==req.body.token && user.userType>0){  //token matching\r\n                    Requests.findOne({_id:req.params.id},(err,request)=>{\r\n    \r\n                       \r\n                            if(!err){\r\n                                    if(request===undefined){\r\n    \r\n                                        res.status(400).send({message:\"no such request exsist\"});\r\n                                    }else{\r\n                                \r\n                                      \r\n                                    request.imageApproved=0;\r\n                                        request.save((err)=>{\r\n    \r\n                                            if(!err){\r\n                                                let newNotification=new Notification();\r\n                                                newNotification.userId=request.userId;\r\n                                                newNotification.message=\"Images Rejected!\"\r\n                                                newNotification.description=req.body.description;\r\n                                                newNotification.type=1;\r\n                                                newNotification.refId=request._id;\r\n                                                newNotification.link=\"/requests\";\r\n                                                User.findById((request.userId),(err,ownerUser)=>{\r\n                                                    \r\n                                                                                                    if(!err){\r\n                                                //sending mail \r\n      var transporter = nodemailer.createTransport({\r\n        service: 'Gmail',\r\n        auth: {\r\n        user: 'toshikverma1@gmail.com', // Your email id\r\n        pass: '123123123a' // Your password\r\n        }\r\n    });\r\n    var templateString = fs.readFileSync('views/rejected.ejs', 'utf-8');\r\n    var mailOptions = {\r\n        from: 'toshikverma@gmail.com', // sender address\r\n        to: ownerUser.email, // list of receivers\r\n        subject: 'Approvals', // Subject line\r\n        html: ejs.render(templateString,{heading:\"Rejected\",name:ownerUser.fname,message:\"Your image/images is/are Rejected\",productName:request.requestName,reason:req.body.description},(err)=>{\r\n        if(err){\r\n            console.log(err);\r\n        }\r\n        }) \r\n        \r\n    };\r\n    transporter.sendMail(mailOptions, function (err, info) {\r\n        if(err)\r\n        console.log(err)\r\n        \r\n        else\r\n        console.log(info);\r\n    });\r\n    //sending mail ends\r\n                                                                                                    }});        \r\n                                                newNotification.save();\r\n                                                res.status(200).send({message:\"image reject!\"});\r\n                                            }else{\r\n    \r\n                                                res.status(400).send({message:\"some problem occured\"});\r\n                                            }\r\n                                        \r\n                                        });\r\n    \r\n                                  \r\n                                        }\r\n    \r\n    \r\n                            }else{\r\n    \r\n                                res.status(400).send(err);\r\n                            }\r\n    \r\n                        \r\n                    });\r\n                        \r\n                        \r\n     \r\n     \r\n                 }else{\r\n                     res.status(400).json({ message: 'invalid token!' });\r\n     \r\n                 }\r\n           \r\n             }\r\n            \r\n         }else{\r\n     \r\n                 res.status(400).send(err);\r\n             }\r\n       \r\n     });\r\n         }\r\n                 });\r\n       });\r\n       //GET REQUESTS BY DYNAMIC QUERY\r\n    api.get('/dynamic/:token/:query/:sortby/:page', (req, res) => {\r\n        //check token\r\n          Login.findOne({token:req.params.token},(err,user)=>{\r\n            if(user==undefined){\r\n             res.status(400).json({ message: 'User not Login!' },);\r\n         }else{\r\n            \r\n    \r\n                let sort=[\"date\",\"rating\"];\r\n                let sortby=\"date\";\r\n                if(sort.indexOf(req.params.sortby) > -1){\r\n\r\n                    sortby=req.params.sortby;\r\n                }\r\n                //checking if page number is correct\r\n                let pageNumber=1\r\n        \r\n                if(!isNaN(req.params.page)){\r\n                   pageNumber=req.params.page;\r\n                 }\r\n                 //async query start here\r\n                 \r\n                 let qry=JSON.parse(decodeURIComponent(req.params.query));\r\n    \r\n                 var countQuery = function(callback){\r\n                    Requests.find(qry, function(err, doc){\r\n                          if(err){ callback(err, null) }\r\n                          else{\r\n                              callback(null, doc.length);\r\n                           }\r\n                    }\r\n                    )};\r\n            \r\n               var retrieveQuery = function(callback){\r\n                 \r\n                   Requests.find(qry).skip((pageNumber-1)*12).sort({sortby: -1}).limit(12).exec(function(err, doc){\r\n                    if(err){ callback(err, null) }\r\n                    else{\r\n                        callback(null, doc);\r\n                     }\r\n              });\r\n                   \r\n              };\r\n            \r\n \r\n               async.parallel([countQuery, retrieveQuery], function(err, results){\r\n                   if(err){\r\n                   // console.log(\"error here\");\r\n                    res.status(500).send(err);\r\n                   }else{\r\n                    res.status(200).json({total_pages:Math.floor(results[0]/12+1) , page: pageNumber, requests: results[1]});\r\n                   }\r\n               });\r\n           \r\n         }\r\n                 });\r\n       });  \r\n         //GET Requests BY SEARCH QUERY\r\n    api.get('/search/:token/:search/:page', (req, res) => {\r\n        //check token\r\n          Login.findOne({token:req.params.token},(err,user)=>{\r\n            if(user==undefined){\r\n             res.status(400).json({ message: 'User not Login!' },);\r\n         }else{\r\n                \r\n                //checking if page number is correct\r\n                let pageNumber=1\r\n        \r\n                if(!isNaN(req.params.page)){\r\n                   pageNumber=req.params.page;\r\n                 }\r\n                 //async query start here\r\n                 var countQuery = function(callback){\r\n                    Requests.find({requestName: new RegExp(req.params.search,\"i\")}, function(err, doc){\r\n                          if(err){ callback(err, null) }\r\n                          else{\r\n                              callback(null, doc.length);\r\n                           }\r\n                    }\r\n                    )};\r\n            \r\n               var retrieveQuery = function(callback){\r\n                Requests.find({requestName: new RegExp(req.params.search,\"i\")}).skip((pageNumber-1)*12).limit(12).exec(function(err, doc){\r\n                    if(err){ callback(err, null) }\r\n                    else{\r\n                        callback(null, doc);\r\n                     }\r\n              });\r\n                   \r\n              };\r\n            \r\n               async.parallel([countQuery, retrieveQuery], function(err, results){\r\n                   if(err){\r\n                   // console.log(\"error here\");\r\n                    res.status(500).send(err);\r\n                   }else{\r\n                    res.status(200).json({total_pages:Math.floor(results[0]/12+1) , page: pageNumber, products: results[1]});\r\n                   }\r\n               });\r\n            \r\n         }\r\n                 });\r\n       });     \r\n          //assigning category\r\n        api.put('/assigncategory/:id', (req, res) => {\r\n            //check token\r\n              User.findOne({email:req.body.email},(err,user)=>{\r\n                if(user==undefined){\r\n                 res.status(400).json({ message: 'User not found!' });\r\n             }else{\r\n         Login.findOne({email:req.body.email},(err,login)=>{\r\n         \r\n             if(!err){\r\n         \r\n                 if(login==undefined){ //user not found\r\n         \r\n                     res.status(400).json({ message: 'User not Logged In!' });\r\n                 }else{\r\n         \r\n                    if(login.token==req.body.token && user.userType>0){  //token matching\r\n                        Requests.findOne({_id:req.params.id},(err,request)=>{\r\n        \r\n                           \r\n                                if(!err){\r\n                                        if(request===undefined){\r\n        \r\n                                            res.status(400).send({message:\"no such product exsist\"});\r\n                                        }else{\r\n                                    \r\n                                          \r\n                                        request.category=req.body.category;\r\n                                            request.save((err)=>{\r\n        \r\n                                                if(!err){\r\n                                                    \r\n                                                                                                           \r\n                                                    \r\n                                                    res.status(200).send({message:\"category updated\"});\r\n                                                }else{\r\n        \r\n                                                    res.status(400).send({message:\"some problem occured\"});\r\n                                                }\r\n                                            \r\n                                            });\r\n        \r\n                                      \r\n                                            }\r\n        \r\n        \r\n                                }else{\r\n        \r\n                                    res.status(400).send(err);\r\n                                }\r\n        \r\n                            \r\n                        });\r\n                            \r\n                            \r\n         \r\n         \r\n                     }else{\r\n                         res.status(400).json({ message: 'invalid token!' });\r\n         \r\n                     }\r\n               \r\n                 }\r\n                \r\n             }else{\r\n         \r\n                     res.status(400).send(err);\r\n                 }\r\n           \r\n         });\r\n             }\r\n                     });\r\n           });\r\n\r\n            //assigning subcategory\r\n        api.put('/assignsubcategory/:id', (req, res) => {\r\n            //check token\r\n              User.findOne({email:req.body.email},(err,user)=>{\r\n                if(user==undefined){\r\n                 res.status(400).json({ message: 'User not found!' });\r\n             }else{\r\n         Login.findOne({email:req.body.email},(err,login)=>{\r\n         \r\n             if(!err){\r\n         \r\n                 if(login==undefined){ //user not found\r\n         \r\n                     res.status(400).json({ message: 'User not Logged In!' });\r\n                 }else{\r\n         \r\n                    if(login.token==req.body.token && user.userType>0){  //token matching\r\n                        Requests.findOne({_id:req.params.id},(err,request)=>{\r\n        \r\n                           \r\n                                if(!err){\r\n                                        if(request===undefined){\r\n        \r\n                                            res.status(400).send({message:\"no such request exsist\"});\r\n                                        }else{\r\n                                    \r\n                                          \r\n                                        request.subCategory=req.body.subcategory;\r\n                                            request.save((err)=>{\r\n        \r\n                                                if(!err){\r\n                                                    \r\n                                                                                                           \r\n                                                    \r\n                                                    res.status(200).send({message:\"subcategory updated\"});\r\n                                                }else{\r\n        \r\n                                                    res.status(400).send({message:\"some problem occured\"});\r\n                                                }\r\n                                            \r\n                                            });\r\n        \r\n                                      \r\n                                            }\r\n        \r\n        \r\n                                }else{\r\n        \r\n                                    res.status(400).send(err);\r\n                                }\r\n        \r\n                            \r\n                        });\r\n                            \r\n                            \r\n         \r\n         \r\n                     }else{\r\n                         res.status(400).json({ message: 'invalid token!' });\r\n         \r\n                     }\r\n               \r\n                 }\r\n                \r\n             }else{\r\n         \r\n                     res.status(400).send(err);\r\n                 }\r\n           \r\n         });\r\n             }\r\n                     });\r\n           });   \r\n\r\n            api.put('/togglehold/:id', (req, res) => {\r\n            //check token\r\n              User.findOne({email:req.body.email},(err,user)=>{\r\n                if(user==undefined){\r\n                 res.status(400).json({ message: 'User not found!' });\r\n             }else{\r\n         Login.findOne({email:req.body.email},(err,login)=>{\r\n         \r\n             if(!err){\r\n         \r\n                 if(login==undefined){ //user not found\r\n         \r\n                     res.status(400).json({ message: 'User not Logged In!' });\r\n                 }else{\r\n         \r\n                    if(login.token==req.body.token && user.userType>0){  //token matching\r\n                        Requests.findOne({_id:req.params.id},(err,product)=>{\r\n        \r\n                           \r\n                                if(!err){\r\n                                        if(product===undefined){\r\n        \r\n                                            res.status(400).send({message:\"no such product exsist\"});\r\n                                        }else{\r\n                                    \r\n                                          if(product.onHold==0){\r\n                                        product.onHold=1;\r\n                                          }else{\r\n                                            product.onHold=0;\r\n                                          }\r\n                                            product.save((err)=>{\r\n        \r\n                                                if(!err){\r\n        \r\n                                                    res.status(200).send({message:\"Hold toggeled\"});\r\n                                                }else{\r\n        \r\n                                                    res.status(400).send({message:\"some problem occured\"});\r\n                                                }\r\n                                            \r\n                                            });\r\n        \r\n                                      \r\n                                            }\r\n        \r\n        \r\n                                }else{\r\n        \r\n                                    res.status(400).send(err);\r\n                                }\r\n        \r\n                            \r\n                        });\r\n                            \r\n                            \r\n         \r\n         \r\n                     }else{\r\n                         res.status(400).json({ message: 'invalid token!' });\r\n         \r\n                     }\r\n               \r\n                 }\r\n                \r\n             }else{\r\n         \r\n                     res.status(400).send(err);\r\n                 }\r\n           \r\n         });\r\n             }\r\n                     });\r\n           });    \r\n  return api;\r\n}\r\n"]}