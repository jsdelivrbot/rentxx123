{"version":3,"sources":["../../src/controller/imageUpload.js"],"names":["config","db","api","update","secretAccessKey","accessKeyId","region","s3","S3","upload","storage","bucket","key","req","file","cb","console","log","Date","now","originalname","post","any","res","files","send","params","Bucket","Delete","Objects","Key","body","deleteObjects","err","data","stack","next","end"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;kBACc,gBAAoB;AAAA,QAAjBA,MAAiB,QAAjBA,MAAiB;AAAA,QAATC,EAAS,QAATA,EAAS;;AAChC,QAAIC,MAAM,sBAAV;;AAEF,qBAAIF,MAAJ,CAAWG,MAAX,CAAkB;AACdC,yBAAiB,0CADH;AAEdC,qBAAa,sBAFC;AAGbC,gBAAQ;AAHK,KAAlB;;AAOE,QAAKC,KAAK,IAAI,iBAAIC,EAAR,EAAV;;AAGF,QAAIC,SAAS,sBAAO;AAChBC,iBAAS,uBAAS;AACdH,gBAAIA,EADU;AAEdI,oBAAQ,kBAFM;AAGdC,iBAAK,aAAUC,GAAV,EAAeC,IAAf,EAAqBC,EAArB,EAAyB;AAC1BC,wBAAQC,GAAR,CAAYH,IAAZ;AACAC,mBAAG,IAAH,EAASG,KAAKC,GAAL,KAAW,GAAX,GAAeL,KAAKM,YAA7B,EAF0B,CAEkB;AAC/C;AANa,SAAT;AADO,KAAP,CAAb;;AAYAlB,QAAImB,IAAJ,CAAS,GAAT,EAAcZ,OAAOa,GAAP,EAAd,EAA4B,UAACT,GAAD,EAAKU,GAAL,EAAY;AACpCP,gBAAQC,GAAR,CAAYJ,IAAIW,KAAhB;AACAD,YAAIE,IAAJ,CAASZ,IAAIW,KAAJ,CAAU,CAAV,EAAaZ,GAAtB;AACH,KAHD;AAIAV,QAAImB,IAAJ,CAAS,SAAT,EAAmB,UAACR,GAAD,EAAKU,GAAL,EAAW;AAC3B,YAAIG,SAAS;AACRC,oBAAQ,kBADA;AAERC,oBAAQ;AACJC,yBAAS,CACL;AACIC,yBAAKjB,IAAIkB,IAAJ,CAASnB;AADlB,iBADK;AADL;;AAFA,SAAb;AAWCL,WAAGyB,aAAH,CAAiBN,MAAjB,EAAyB,UAAUO,GAAV,EAAeC,IAAf,EAAqB;AAC1C,gBAAID,GAAJ,EAAS;AACLjB,wBAAQC,GAAR,CAAYgB,GAAZ,EAAiBA,IAAIE,KAArB;AACA,uBAAOC,KAAKH,GAAL,CAAP;AACH;AACDjB,oBAAQC,GAAR,CAAYiB,IAAZ;AACAX,gBAAIc,GAAJ,CAAQ,MAAR;AACC,SAPL;AAQH,KApBD;;AAwBE,WAAOnC,GAAP;AACD,C","file":"imageUpload.js","sourcesContent":["import { Router } from 'express';\r\nimport multer from 'multer';\r\nimport fs from 'fs';\r\nimport aws from 'aws-sdk';\r\nimport multerS3 from 'multer-s3';\r\nexport default({ config, db }) => {\r\n  let api = Router();\r\n\r\naws.config.update({\r\n    secretAccessKey: 'XGNpMC1dwlbP0AOaYPbTc5+3ghnwqd5GgYnV4snB',\r\n    accessKeyId: 'AKIAJ46V3SLDKEFSFLZA',\r\n     region: 'sa-east-1'\r\n});\r\n\r\n\r\n  var  s3 = new aws.S3();\r\n\r\n\r\nvar upload = multer({\r\n    storage: multerS3({\r\n        s3: s3,\r\n        bucket: 'rentophilaimages',\r\n        key: function (req, file, cb) {\r\n            console.log(file);\r\n            cb(null, Date.now()+\"_\"+file.originalname); //use Date.now() for unique file keys\r\n        }\r\n    })\r\n});\r\n\r\n\r\napi.post('/', upload.any(), (req,res)=> {\r\n    console.log(req.files);\r\n    res.send(req.files[0].key);\r\n});\r\napi.post('/delete',(req,res)=>{\r\n   var params = {\r\n        Bucket: 'rentophilaimages',\r\n        Delete: {\r\n            Objects: [\r\n                {\r\n                    Key: req.body.key\r\n                }\r\n            ]\r\n        }\r\n\r\n    }\r\n    s3.deleteObjects(params, function (err, data) {\r\n        if (err) {\r\n            console.log(err, err.stack);\r\n            return next(err);\r\n        }\r\n        console.log(data);\r\n        res.end('done');\r\n        });\r\n});\r\n\r\n\r\n\r\n  return api;\r\n}"]}